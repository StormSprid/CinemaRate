<!DOCTYPE html>
<html lang="ru">
<head>
    <link rel="stylesheet" href="css/style.css">
    <meta charset="UTF-8"/>
    <title>–í—Å–µ —Ñ–∏–ª—å–º—ã</title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
</head>
<body>
<div id="header-placeholder"></div>


<div class="movie-list" id="moviesContainer"></div>

<script>
    fetch("/movie/all")
        .then(response => response.json())
        .then(movies => {
            const container = document.getElementById("moviesContainer");
            container.innerHTML = "";

            if (movies.length === 0) {
                container.innerHTML = "<p>–ù–µ—Ç —Ñ–∏–ª—å–º–æ–≤ –≤ –±–∞–∑–µ.</p>";
                return;
            }

            movies.forEach(movie => {
                const div = document.createElement("div");
                div.className = "movie-card";
                div.innerHTML = `
                    <h2 class="movie-title">
                        <a href="movie.html?id=${movie.id}">${movie.title}</a>
                    </h2>
                    <div class="movie-year">${movie.year}</div>
                    <div class="movie-description">${movie.description}</div>
                `;
                container.appendChild(div);
            });
        })
        .catch(error => {
            const container = document.getElementById("moviesContainer");
            container.innerHTML = "<p>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö üò¢</p>";
            console.error("–û—à–∏–±–∫–∞:", error);
        });

    fetch("/fragments/header.html")
        .then(response => response.text())
        .then(html => {
            document.getElementById('header-placeholder').innerHTML = html;

            // –ó–∞–≥—Ä—É–∑–∏–ª–∏ ‚Äî —Ç–µ–ø–µ—Ä—å –≤—ã–∑–æ–≤–µ–º fetchUserName –≤—Ä—É—á–Ω—É—é
            if (typeof fetchUserName === "function") {
                fetchUserName();
            } else {
                // –ï—Å–ª–∏ —Ñ—É–Ω–∫—Ü–∏—è –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ ‚Äî –∑–∞–≥—Ä—É–∑–∏ —Å–∫—Ä–∏–ø—Ç —è–≤–Ω–æ
                const script = document.createElement("script");
                script.src = "/js/header.js";
                script.onload = () => fetchUserName();
                document.body.appendChild(script);
            }
        })
        .catch(error => {
            console.error('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å header:', error);
        });
</script>
</body>
</html>
