<!DOCTYPE html>
<html lang="ru">
<head>
<link rel="stylesheet" href="css/style.css">
    <title>Movie</title>
    <meta charset="UTF-8" />
</head>
<body>
<header class="main-header">
    <div class="header-content">
        <a href="movies.html">
        <img src="/images/logo.png" alt="–õ–æ–≥–æ—Ç–∏–ø" class="logo-icon">
        <h1 class="site-title">CinemaRate</h1>
            </a>
    </div>
    <a href="index.html" class="header-button">Exit</a>
</header>

<div class="container">
    <div class="header">
        <img class="poster" id="poster" src="" alt="–ü–æ—Å—Ç–µ—Ä —Ñ–∏–ª—å–º–∞">
        <div class="text-info">
            <h1 id="title">–ó–∞–≥—Ä—É–∑–∫–∞...</h1>
            <div class="year" id="year"></div>
            <div class="description" id="description"></div>
            <div class="rating" id="meanRating"></div>
        </div>
    </div>
    <div class="reviews" id="reviews">
        <h2>–û—Ç–∑—ã–≤—ã</h2>
        <div id="reviewsList"></div>
    </div>
</div>

<script>
    // –ü–æ–ª—É—á–∞–µ–º ID –∏–∑ URL
    const urlParams = new URLSearchParams(window.location.search);
    const movieId = urlParams.get("id");

    if (!movieId) {
        document.getElementById("title").textContent = "ID —Ñ–∏–ª—å–º–∞ –Ω–µ —É–∫–∞–∑–∞–Ω –≤ URL";
    } else {
        fetch(`/movie/${movieId}`)
            .then(response => {
                if (!response.ok) {
                    throw new Error("–§–∏–ª—å–º –Ω–µ –Ω–∞–π–¥–µ–Ω");
                }
                return response.json();
            })
            .then(data => {
                document.getElementById("title").textContent = data.title;
                document.getElementById("year").textContent = "–ì–æ–¥ –≤—ã–ø—É—Å–∫–∞: " + data.year;
                document.getElementById("description").textContent = data.description;
                document.getElementById("poster").src = data.posterUrl || "/static/images/no-image.png";

                let sum = 0;
                data.reviews.forEach(r => sum += r.rating);
                const meanRating = (data.reviews.length > 0)
                    ? (sum / data.reviews.length).toFixed(2)
                    : "–ù–µ—Ç –æ—Ü–µ–Ω–æ–∫";

                document.getElementById("meanRating").textContent = "‚≠ê –°—Ä–µ–¥–Ω—è—è –æ—Ü–µ–Ω–∫–∞: " + meanRating;

                const reviewsList = document.getElementById("reviewsList");
                data.reviews.forEach(review => {
                    const div = document.createElement("div");
                    div.className = "review";
                    div.innerHTML = `
                        <strong>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å #${review.userId}</strong>:
                        <span>–æ—Ü–µ–Ω–∫–∞ ${review.rating}</span>
                    `;
                    reviewsList.appendChild(div);
                });
            })
            .catch(error => {
                document.getElementById("title").textContent = "–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∏–ª—å–º–∞ üò¢";
                console.error("–û—à–∏–±–∫–∞:", error);
            });
    }
</script>
</body>
</html>
