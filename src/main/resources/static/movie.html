<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <title>–í—Å–µ —Ñ–∏–ª—å–º—ã</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f4f4f4;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 900px;
            margin: 20px auto;
            background: #fff;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 15px rgba(0, 0, 0, 0.1);
        }
        .header {
            display: flex;
            align-items: flex-start;
            gap: 20px;
        }
        .poster {
            width: 200px;
            height: auto;
            border-radius: 8px;
            object-fit: cover;
            box-shadow: 0 0 5px rgba(0,0,0,0.3);
        }
        .text-info {
            flex: 1;
        }
        h1 {
            margin-top: 0;
            margin-bottom: 10px;
            color: #333;
        }
        .description {
            margin: 10px 0;
            color: #555;
        }
        .year {
            font-weight: bold;
            color: #777;
        }
        .rating {
            font-size: 18px;
            color: #ff9800;
            margin-top: 10px;
        }
        .reviews {
            margin-top: 20px;
        }
        .review {
            padding: 10px;
            border-bottom: 1px solid #ccc;
        }
        .review:last-child {
            border-bottom: none;
        }
    </style>
</head>
<body>
<div id="reviewsList"></div>

<script>
    fetch("/movie/all")
        .then(response => response.json())
        .then(movies => {
            const container = document.getElementById("reviewsList");
            container.innerHTML = ""; // –æ—á–∏—Å—Ç–∏–º

            if (movies.length === 0) {
                container.innerHTML = "<p>–ù–µ—Ç —Ñ–∏–ª—å–º–æ–≤ –≤ –±–∞–∑–µ.</p>";
                return;
            }

            movies.forEach(movie => {
                let meanRating = "–ù–µ—Ç –æ—Ü–µ–Ω–æ–∫";
                if (movie.reviews && movie.reviews.length > 0) {
                    const sum = movie.reviews.reduce((acc, r) => acc + r.rating, 0);
                    meanRating = (sum / movie.reviews.length).toFixed(2);
                }

                const div = document.createElement("div");
                div.className = "container";
                div.innerHTML = `
            <div class="header">
              <img class="poster" src="${movie.posterUrl || '/static/images/no-image.png'}" alt="–ü–æ—Å—Ç–µ—Ä —Ñ–∏–ª—å–º–∞">
              <div class="text-info">
                <h1>${movie.title}</h1>
                <div class="year">–ì–æ–¥ –≤—ã–ø—É—Å–∫–∞: ${movie.year}</div>
                <div class="description">${movie.description}</div>
                <div class="rating">‚≠ê –°—Ä–µ–¥–Ω—è—è –æ—Ü–µ–Ω–∫–∞: ${meanRating}</div>
              </div>
            </div>
            <div class="reviews">
              <h2>–û—Ç–∑—ã–≤—ã</h2>
              ${movie.reviews.map(review => `
                <div class="review">
                  <strong>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å #${review.userId}</strong>:
                  <span>–æ—Ü–µ–Ω–∫–∞ ${review.rating}</span>
                </div>
              `).join("")}
            </div>
          `;
                container.appendChild(div);
            });
        })
        .catch(error => {
            const container = document.getElementById("reviewsList");
            container.innerHTML = "<p>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö üò¢</p>";
            console.error("–û—à–∏–±–∫–∞:", error);
        });
</script>
</body>
</html>
